<!DOCTYPE html>
<html>
<!--смотреть chat gpt-->
<head>
  <title>Add Warehouse Movement</title>
</head>

<body>
  <!-- Заголовок страницы -->
  <h1>Add Warehouse Movement</h1>

  <!-- Форма для добавления перемещения на складе -->
  <form method="post" action="{% url 'add_warehouse_movement' %}">
    {% csrf_token %} <!-- CSRF-токен для безопасности формы -->

    <!-- Выбор склада для уменьшения количества товара -->
    <label for="id_warehouse_minus">Warehouse Minus:</label>
    <select name="id_warehouse_minus" id="id_warehouse_minus">
      {% for warehouse in warehouses %}
      <option value="{{ warehouse.id }}">{{ warehouse.address }}</option>
      {% endfor %}
    </select><br><br>

    <!-- Выбор компонента и обновление Quantity через JavaScript -->
    <label for="component_name">Component Name:</label>
    <select name="component_name" id="component_name">
      {% for component in components %}
      <option value="{{ component.id }}" data-quantity="{{ component.quantity }}">{{ component.name }}</option>
      {% endfor %}
    </select><br><br>

    <!-- Поле для ввода количества товара и опция редактирования -->
    <label for="quantity">Quantity</label>
    <input type="number" name="quantity" id="quantity" value="{{ total_quantity }}" disabled>
    <input type="checkbox" name="enable_edit" id="enable_edit" onchange="toggleEdit()">
    <label for="enable_edit">Enable Edit</label><br><br>

    <!-- Выбор склада для увеличения количества товара -->
    <label for="id_warehouse_plus">Warehouse Plus:</label>
    <select name="id_warehouse_plus">
      {% for warehouse in warehouses %}
      <option value="{{ warehouse.id }}">{{ warehouse.address }}</option>
      {% endfor %}
    </select><br><br>

    <!-- Поле для ввода даты перемещения -->
    <label for="date">Date:</label>
    <input type="datetime-local" name="date" id="id_date" required><br><br>

    <!-- Поле для ввода комментария -->
    <label for="comment">Comment:</label>
    <input type="text" name="comment"><br><br>

    <!-- Кнопка для отправки формы и вызова функции showItems -->
    <button type="button" onclick="showItems()">Show Items</button>

    <!-- Кнопка для отправки формы и ссылка на домашнюю страницу -->
    <button type="submit" name="add_movement">Add Movement</button>
    <a href="{% url 'warehouse_movements' %}"><button type="button">Go to home</button></a>
  </form>

  <!-- Скрипты JavaScript -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // При изменении Component Name вызывается updateQuantity
      document.getElementById('component_name').addEventListener('change', updateQuantity);
    });

    // Функция для обновления значения Quantity при выборе компонента
    function updateQuantity() {
      var componentSelect = document.getElementById('component_name');
      var quantityInput = document.getElementById('quantity');

      var selectedComponentOption = componentSelect.options[componentSelect.selectedIndex];
      var selectedComponentId = selectedComponentOption.value;

      // Проверка, что компонент выбран
      if (selectedComponentId) {
        // Отправляем запрос на сервер для получения total_quantity
        fetch(`/get_total_quantity/?component_id=${selectedComponentId}`)
          .then(response => response.json())
          .then(data => {
            quantityInput.value = data.total_quantity;
          })
          .catch(error => {
            console.error('Error:', error);
          });
      }
    }

    // Функция для включения/выключения редактирования количества
    function toggleEdit() {
      var quantityInput = document.getElementById('quantity');
      var enableEditCheckbox = document.getElementById('enable_edit');
      quantityInput.disabled = !enableEditCheckbox.checked;
    }

    // Функция для показа таблицы с данными при нажатии кнопки Show Items
    function showItems() {
      var componentSelect = document.getElementById('component_name');
      var selectedComponentOption = componentSelect.options[componentSelect.selectedIndex];

      // Проверка, что IdComponents выбран
      if (selectedComponentOption) {
        // Показать таблицу с данными
        document.getElementById('item_table').style.display = 'block';
      }
    }
  </script>

  <!-- Футер с таблицей данных -->
  <footer id="item_table" style="display: none;">
    <table border="1">
      <tr>
        <th>IdWarehouse</th>
        <th>IdComponents</th>
        <th>Total Quantity</th>
      </tr>
      <!-- Здесь можно вставить данные из вашего контекста или оставить пустым, в зависимости от логики вашего приложения -->
    </table>
  </footer>

</body>

</html>
